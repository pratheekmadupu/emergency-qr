<!DOCTYPE html>
<html>
<head>
<title>ResQR Admin Panel</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<!-- QR generator -->
<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

<style>
body{
margin:0;
background:#0b1220;
font-family:system-ui;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
color:white;
}

.panel{
width:380px;
background:#121a2f;
padding:28px;
border-radius:26px;
box-shadow:0 25px 70px rgba(0,0,0,.7);
text-align:center;
}

.logo{width:200px;margin-bottom:10px;}

input{
width:100%;
padding:12px;
margin:7px 0;
border:none;
border-radius:12px;
background:#1c2542;
color:white;
font-size:15px;
}

button{
width:100%;
padding:14px;
margin-top:10px;
border:none;
border-radius:14px;
font-weight:700;
cursor:pointer;
}

.save{background:#22c55e;color:#002b10;}
.copy{background:#3b82f6;color:white;}
.download{background:#ff3b3b;color:white;}

.link{margin-top:12px;font-size:12px;word-break:break-all;}

#qrcode{
margin-top:14px;
background:white;
padding:12px;
border-radius:12px;
display:inline-block;
}

.popup{
position:fixed;
top:20px;
left:50%;
transform:translateX(-50%);
background:#22c55e;
color:#002b10;
padding:14px 26px;
border-radius:14px;
font-weight:700;
opacity:0;
transition:.4s;
}
.popup.show{opacity:1;top:40px;}
</style>
</head>

<body>

<div class="panel">
<img src="logo.png" class="logo">
<h2>Create Emergency QR</h2>

<form id="form">

<input id="uid" placeholder="User ID">
<input id="username" placeholder="Name">
<input id="blood" placeholder="Blood Group">
<input id="family" placeholder="Family Phone with country code">
<input id="health" placeholder="Health Issue">

<button type="button" class="save" onclick="saveUser()">Save & Generate QR</button>

</form>

<div id="qrLink" class="link"></div>
<div id="qrcode"></div>

<button type="button" class="copy" onclick="copyLink()">Copy Link</button>
<button type="button" class="download" onclick="downloadQR()">Download QR</button>
</div>

<div id="popup" class="popup">âœ” Successfully Saved</div>

<script>

/* PREVENT PAGE RELOAD */
document.getElementById("form").addEventListener("submit",e=>e.preventDefault());

/* ðŸ”´ CHANGE ONLY IF REPO NAME CHANGES */
const PROJECT_NAME = "emergency-qr";

/* ðŸ”´ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyBFXvSwZSrMbYHQkrge6UyZOv2uxU0VkPA",
  authDomain: "emergency-qr-b0adf.firebaseapp.com",
  databaseURL: "https://emergency-qr-b0adf-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "emergency-qr-b0adf",
  storageBucket: "emergency-qr-b0adf.firebasestorage.app",
  messagingSenderId: "326186798135",
  appId: "1:326186798135:web:21b57be22dff85849303b2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let currentLink="";

/* SAVE USER */
function saveUser(){

const id = document.getElementById("uid").value.trim();
const nameVal = document.getElementById("username").value.trim();
const bloodVal = document.getElementById("blood").value.trim();
const familyVal = document.getElementById("family").value.trim();
const healthVal = document.getElementById("health").value.trim();

if(id==="" || nameVal===""){
alert("Enter User ID & Name");
return;
}

db.ref("users/"+id).set({
name:nameVal,
blood:bloodVal,
family:familyVal,
health:healthVal
})
.then(()=>{

/* CORRECT GITHUB LINK */
currentLink = location.origin + "/" + PROJECT_NAME + "/?id=" + id;

/* SHOW LINK */
document.getElementById("qrLink").innerText=currentLink;

/* GENERATE QR */
document.getElementById("qrcode").innerHTML="";
new QRCode(document.getElementById("qrcode"),{
text:currentLink,
width:180,
height:180
});

/* POPUP */
const popup=document.getElementById("popup");
popup.classList.add("show");
setTimeout(()=>popup.classList.remove("show"),2000);

/* CLEAR FORM */
document.getElementById("form").reset();

})
.catch(e=>alert("Firebase Error: "+e));
}

/* COPY LINK */
function copyLink(){
if(!currentLink) return;
navigator.clipboard.writeText(currentLink);
alert("Link copied");
}

/* DOWNLOAD QR */
function downloadQR(){
const img=document.querySelector("#qrcode img");
if(!img){alert("Generate QR first");return;}

const a=document.createElement("a");
a.href=img.src;
a.download="ResQR.png";
a.click();
}
</script>

</body>
</html>
