<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ResQR Emergency</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

<style>
body{
margin:0;
font-family:system-ui;
background:#0b1220;
display:flex;
justify-content:center;
align-items:center;
height:100vh;
color:white;
}

/* CARD */
.card{
width:360px;
background:#121a2f;
border-radius:28px;
padding:30px;
text-align:center;
box-shadow:0 20px 60px rgba(0,0,0,.6);
}

/* BIGGER LOGO */
.logo{
width:240px;
margin-bottom:20px;
}

/* INFO BLOCK */
.info{
background:#1c2542;
padding:16px;
border-radius:18px;
margin-bottom:14px;
font-size:18px;
text-align:left;
line-height:1.6;
}

/* LABELS */
.label{
color:#9ca3af;
font-weight:600;
}

/* VALUE */
.value{
color:white;
font-weight:700;
}

/* BUTTONS */
button{
width:100%;
padding:15px;
border:none;
border-radius:18px;
font-size:17px;
font-weight:700;
margin-top:12px;
cursor:pointer;
}

.call{background:#22c55e;color:#002b10;}
.loc{background:#3b82f6;color:white;}
</style>
</head>

<body>

<div class="card">

<img src="logo.png" class="logo">

<div class="info">
<span class="label">NAME :</span>
<span id="name" class="value">Loading...</span>
</div>

<div class="info">
<span class="label">BLOOD GROUP :</span>
<span id="blood" class="value">--</span>
</div>

<div class="info">
<span class="label">HEALTH ISSUE :</span>
<span id="health" class="value">Loading...</span>
</div>

<button id="callBtn" class="call">üìû Call Family</button>
<button id="locBtn" class="loc">üìç Send Location</button>

</div>

<script>

/* üî¥ FIREBASE CONFIG */
const firebaseConfig = {
 apiKey: "AIzaSyBFXvSwZSrMbYHQkrge6UyZOv2uxU0VkPA",
  authDomain: "emergency-qr-b0adf.firebaseapp.com",
  databaseURL: "https://emergency-qr-b0adf-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "emergency-qr-b0adf",
  storageBucket: "emergency-qr-b0adf.firebasestorage.app",
  messagingSenderId: "326186798135",
  appId: "1:326186798135:web:21b57be22dff85849303b2"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* GET ID */
const id = new URLSearchParams(window.location.search).get("id");

if(!id){
document.getElementById("name").innerText="Invalid QR";
throw "No ID";
}

/* LOAD DATA */
db.ref("users/"+id).once("value").then(snapshot=>{

if(!snapshot.exists()){
document.getElementById("name").innerText="User Not Found";
return;
}

const d=snapshot.val();

document.getElementById("name").innerText=d.name;
document.getElementById("blood").innerText=d.blood;
document.getElementById("health").innerText=d.health;

/* CALL */
document.getElementById("callBtn").onclick=()=>{
location.href="tel:"+d.family;
};

/* WHATSAPP LOCATION */
document.getElementById("locBtn").onclick=()=>{
navigator.geolocation.getCurrentPosition(pos=>{
const map=`https://maps.google.com/?q=${pos.coords.latitude},${pos.coords.longitude}`;

const msg=`üö® EMERGENCY ALERT üö®
${d.name} may need help.

Live Location:
${map}`;

window.open(`https://wa.me/${d.family}?text=${encodeURIComponent(msg)}`,"_blank");

},()=>alert("Location permission denied"));
};

});

</script>

</body>
</html>
